{% extends 'base.html' %}
{% load static %}
{% block top_includes %}
    <script src="/static/js/nodes/registrations.js"></script>
{% endblock %}
{% load user_extras %}
{% load node_extras %}
{% block title %}
    {% if node.is_registration %}
        <title>Registration</title>
    {% else %}
        <title>Node</title>
    {% endif %}
{% endblock title %}
{% block content %}
    <div class="container-fluid">
        <ul class="messages">
            {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
        <div class="row">
            <div class="col-md-12">
                <div class="btn-group" role="group">
                    <a href="{% url 'nodes:search' %}" class="btn btn-primary"> <i class="fa fa-search"></i></a>
                    <a href="{% url 'nodes:node-logs' node.guid %}" class="btn btn-primary">View Logs</a>
                    {%  if perms.osf.delete_node %}
                        {% if not node.is_registration %}
                            {% if not node.deleted %}
                                <a href="{% url 'nodes:remove' guid=node.guid %}"
                                   data-toggle="modal" data-target="#deleteModal"
                                        class="btn btn-danger">
                                    Delete Node
                                </a>
                                <div class="modal" id="deleteModal">
                                    <div class="modal-dialog">
                                        <div class="modal-content"></div>
                                        {# Data from above link #}
                                    </div>
                                </div>
                            {% else %}
                                <form style="display: inline;" method="post" action="{% url 'nodes:restore' guid=node.guid %}">
                                    {% csrf_token %}
                                    <input class="btn btn-success" type="submit" value="Restore Node" />
                                </form>
                            {% endif %}
                        {% else %}
                            {% if node.is_stuck_registration %}
                                <a href="{% url 'nodes:restart-stuck-registrations' guid=node.guid %}"
                                   data-toggle="modal" data-target="#confirmRestartRegistration"
                                   class="btn btn-warning">
                                    Restart Registration
                                </a>
                                <a href="{% url 'nodes:remove-stuck-registrations' guid=node.guid %}"
                                   data-toggle="modal" data-target="#confirmRemoveRegistration"
                                   class="btn btn-danger">
                                    Remove Registration
                                </a>
                            {% endif %}

                        {% endif %}
                    {% endif %}
                    {% if node.is_public %}
                        <a href="{% url 'nodes:make-node-private' guid=node.guid %}"
                           data-toggle="modal" data-target="#confirmMakeHam"
                           class="btn btn-warning">
                            Make Private
                        </a>
                        <div class="modal" id="confirmMakeHam">
                            <div class="modal-dialog">
                                <div class="modal-content"></div>
                                {# Data from above link #}
                            </div>
                        </div>
                    {% endif %}
                    {% if perms.osf.mark_spam %}
                        <a href="{% url 'nodes:confirm-spam' guid=node.guid %}"
                           data-toggle="modal" data-target="#confirmSpamModal"
                           class="btn btn-warning">
                            Confirm Spam
                        </a>
                        <div class="modal" id="confirmSpamModal">
                            <div class="modal-dialog">
                                <div class="modal-content"></div>
                                {# Data from above link #}
                            </div>
                        </div>
                        <a href="{% url 'nodes:confirm-ham' guid=node.guid %}"
                           data-toggle="modal" data-target="#confirmHamModal"
                           class="btn btn-default">
                            Confirm <strong>Not</strong> Spam
                        </a>
                        <div class="modal" id="confirmHamModal">
                            <div class="modal-dialog">
                                <div class="modal-content"></div>
                                {# Data from above link #}
                            </div>
                        </div>
                    {% endif %}
                    <a href="{% url 'nodes:reindex-share-node' guid=node.guid %}"
                       data-toggle="modal" data-target="#confirmReindexShareNode"
                       class="btn btn-default">
                        SHARE Reindex
                    </a>
                    <div class="modal" id="confirmReindexShareNode">
                        <div class="modal-dialog">
                            <div class="modal-content"></div>
                            {# Data from above link #}
                        </div>
                    </div>
                    <div class="modal" id="confirmRestartRegistration">
                        <div class="modal-dialog">
                            <div class="modal-content"></div>
                            {# Data from above link #}
                        </div>
                    </div>
                    <div class="modal" id="confirmRemoveRegistration">
                        <div class="modal-dialog">
                            <div class="modal-content"></div>
                            {# Data from above link #}
                        </div>
                    </div>
                    <a href="{% url 'nodes:reindex-elastic-node' guid=node.guid %}"
                       data-toggle="modal" data-target="#confirmReindexElasticNode"
                       class="btn btn-default">
                        Elastic Reindex
                    </a>
                    <div class="modal" id="confirmReindexElasticNode">
                        <div class="modal-dialog">
                            <div class="modal-content"></div>
                            {# Data from above link #}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <h1>{{ node.title }} <a href="{{ node.guid | reverse_node }}">({{ node.guid }})</a></h1>
            <label>{{ node.type }}</label>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Sanction</td>
                        <td>{{ node.sanction }}</td>
                    </tr>
                    <tr>
                        <td>Public</td>
                        <td>{{ node.is_public }}</td>
                    </tr>
                    <tr>
                        <td>Moderation State</td>
                        <td>{{ node.moderation_state }}</td>
                    </tr>
                    <tr>
                        <td>Creator</td>
                        <td><a href="{{ node.creator.id | reverse_user }}">{{ node.creator }}</a></td>
                    </tr>
                    <tr>
                        <td>Provider</td>
                        {% if node.provider %}
                            <td><a href="{{ node.provider.id | reverse_registration_provider }}">{{ node.provider.name }}</a></td>
                        {% else %}
                            <td>None</td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td>Parent</td>
                        <td>
                            {% if not node.parent %}
                                None
                            {% else %}
                                <a href="{{ node.parent | reverse_node }}">{{ node.parent }}</a>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>IA url</td>
                        <td>{{ node.ia_url }}</td>
                    </tr>
                    {% include "nodes/contributors.html" with registrations=node.contributors.all %}
                    {% include "nodes/spam_status.html" with node=node %}
                    {% include "nodes/schema_responses.html" with schema_responses=node.schema_responses.all %}
                    {% include "nodes/retraction.html" with retraction=node.retraction %}
                    {% include "nodes/registrations.html" with registrations=node.registrations.all %}
                    {% include "nodes/children.html" with children=node.children.all %}
                    {% include "nodes/embargo.html" with embargo=node.embargo %}
                    {% include "nodes/registration_approval.html" with registration_approval=node.registration_approval %}</td>
                    {% include "nodes/actions.html" with actions=node.actions.all|order_by:"created" %}
                    {% include "nodes/storage_usage.html" with node=node %}
                </tbody>
            </table>
        </div>
    </div>

{% endblock content %}

