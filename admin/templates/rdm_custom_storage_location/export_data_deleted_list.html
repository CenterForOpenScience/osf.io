{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% load render_bundle from webpack_loader %}

{% block top_includes %}
    <link rel="stylesheet" type="text/css" href="/static/css/institutions.css"/>
{% endblock %}

{% block title %}
    <title>{% trans "Deleted Export Data List" %}</title>
{% endblock title %}

{% block content %}
    <h2>{% trans "Deleted Export Data List" %}<br/><small>(for {{ institution_name }})</small></h2>

    <form method="post" action="{% url 'custom_storage_location:export_data:export_data_deleted_list' %}" class="form-horizontal"
          id="entitlements_form">
        {% csrf_token %}
        <div class="form-group">
            <label class="col-sm-2 control-label text-left" style="">Export source storage</label>
            <div class="col-sm-9">
                <select class="form-control" name="storage_name" style="max-width: 320px;">
                    {% for storage in list_storage %}
                        {% if storage.id == selected_source %}
                            <option value={{ storage.id }} selected="selected">{{ storage.name }}</option>
                        {% else %}
                            <option value={{ storage.id }}>{{ storage.name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label text-left" style="">Export data storage location</label>
            <div class="col-sm-9" style="display: flex; gap: 10px;">
                <select class="form-control" name="location_export_name" style="max-width: 320px; flex: auto">
                    {% for location in list_location %}
                        {% if location.id == selected_location_export %}
                            <option value={{ location.id }} selected="selected">{{ location.name }}</option>
                        {% else %}
                            <option value={{ location.id }}>{{ location.name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-12">
                <button type="submit" id="filter_export" class="btn btn-primary" style="min-width: 90px;">{% trans "Filter" %}</button>
                <a href={% url 'custom_storage_location:export_data:export_data_deleted_list' %}>
                    <button type="button" class="btn btn-primary" style="min-width: 90px; margin-left:10px;">
                        {% trans "Revert Export Data" %}
                    </button>
                </a>
            </div>
        </div>
    </form>

    {% include "util/pagination.html" with items=page status=status %}
    <table class="table table-striped table-hover table-bordered table-responsive">
        <thead>
        <tr>
            <th width="20px">
                <input type="checkBox" id="check_revert_all" style="width: 15px; height: 15px;">
            </th>
            <th>{% trans "ID" %}</th>
            <th>{% trans "Export source storage" %}</th>
            <th>{% trans "Export data storage location" %}</th>
            <th>{% trans "Process start" %}</th>
            <th>{% trans "Process end" %}</th>
            <th>{% trans "Number of projects" %}</th>
            <th>{% trans "Number of files" %}</th>
            <th>{% trans "Total file size" %}</th>
        </tr>
        </thead>
        <tbody>
        {% for item in list_export_data %}
            <tr class="">
                <td width="20px">
                    <input type="checkBox" name="check_revert_export" id={{ item.export_data.id }} title=""
                           style="width: 14px; height: 14px;">
                </td>
                <td class=""><a href={% url 'custom_storage_location:export_data_information' item.export_data.id %}>{{ item.export_data.id }}</a></td>
                <td class="">{{ item.source_name }}</td>
                <td class="">{{ item.location_name }}</td>
                <td class="">{{ item.export_data.process_start }}</td>
                <td class="">{{ item.export_data.process_end }}</td>
                <td class="">{{ item.export_data.project_number }}</td>
                <td class="">{{ item.export_data.file_number }}</td>
                <td class="">{{ item.export_data.total_size }} KB</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <button type="button" class="btn btn-primary" id="revert_button"
            data-target="#revert" data-toggle="modal">{% trans "Revert" %}</button>

    <style type="text/css">
        .modal.middle {
            text-align: center;
            padding: 0 !important;
        }

        .modal.middle:before {
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -4px; /* Adjusts for spacing */
        }

        .modal.middle .modal-dialog {
            display: inline-block;
            text-align: left;
            vertical-align: middle;
        }
    </style>

    <div class="modal middle fade" id="revert" tabindex="-1" aria-labelledby="revertLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" action={% url 'custom_storage_location:export_data:export_data_revert' %}>
                {% csrf_token %}
                <div class="modal-content" id="bodyrevertmodal">
                    <!--<div class="modal-header">-->
                    <!--    <h4 class="modal-title" id="revertLabel">Confirm to revert</h4>-->
                    <!--</div>-->
                    <div class="modal-body text-left">
                        <p>Are you sure you want to revert these export data?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel_modal" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="submitRevertButton" disabled>Revert</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(() => {
            $('#check_revert_all').on('change', () => {
                let check = $('#check_revert_all').is(':checked');
                if (check) {
                    $('input[type=checkbox][name=check_revert_export]').prop('checked', true);
                } else {
                    $('input[type=checkbox][name=check_revert_export]').prop('checked', false);
                }
            });
            $('#revert_button').on('click', () => {
                let list_export_data = $('input[type=checkbox][name=check_revert_export]');
                let list_export_id = '';
                for (let i = 0; i < list_export_data.length; i++) {
                    if (list_export_data[i].checked) {
                        list_export_id += list_export_data[i].id + '#';
                    }
                }
                if (list_export_id.length > 0) {
                    $('#submitRevertButton').removeAttr('disabled');
                }
                $('#bodyrevertmodal').append(`<input type='text' value=${list_export_id} id='input_export_data' class='buckinput' name='list_id_export_data' style='display: none;' />`);
            });
            $('input[type=checkbox][name=check_delete_export]').on('change', () => {
                let list_export_data = $('input[type=checkbox][name=check_delete_export]');
                let count_checked = $('input[type=checkbox][name=check_delete_export]:checked').length;
                if (count_checked !== list_export_data.length) {
                    $("#check_delete_export_all").prop('checked', false);
                } else {
                    $("#check_delete_export_all").prop('checked', true);
                }
            });
            $('.cancel_modal').on('click', () => {
                $('#input_export_data').remove();
            });
        });
    </script>
{% endblock content %}
