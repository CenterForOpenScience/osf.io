# -*- coding: utf-8 -*-
# Generated by Django 1.9 on 2017-03-20 16:41
from __future__ import unicode_literals

import dirtyfields.dirtyfields
from django.conf import settings
from django.contrib.admin.models import LogEntry
from django.contrib.auth.models import Group, Permission
import django.contrib.postgres.fields
from django.core.management.sql import emit_post_migrate_signal
from django.db import connection, migrations, models
import django.db.models.deletion
import django.db.models.manager
import django.utils.timezone
import functools
from osf.models import AbstractNode
import osf.models.admin_log_entry
import osf.models.base
import osf.models.conference
import osf.models.mixins
import osf.models.oauth
import osf.models.sanctions
import osf.models.spam
import osf.models.user
import osf.models.validators
import osf.utils.datetime_aware_jsonfield
import osf.utils.fields
import website.addons.wiki.model
import website.security

import logging

logger = logging.getLogger(__file__)


# Functions from the following migrations needed manual copying.

# osf.migrations.0033_create_permissions_for_admin_groups
def get_read_only_permissions():
    return Permission.objects.filter(
        models.Q(codename='view_node') |
        models.Q(codename='view_registration') |
        models.Q(codename='view_user') |
        models.Q(codename='view_conference') |
        models.Q(codename='view_spam') |
        models.Q(codename='view_metrics') |
        models.Q(codename='view_desk')
    )


def get_admin_permissions():
    return Permission.objects.filter(
        models.Q(codename='change_node') |
        models.Q(codename='delete_node') |
        models.Q(codename='change_user') |
        models.Q(codename='change_conference') |
        models.Q(codename='mark_spam')
    )


def get_prereg_admin_permissions():
    return Permission.objects.filter(
        models.Q(codename='view_prereg') |
        models.Q(codename='administer_prereg')
    )


def add_group_permissions(*args):
    # this is to make sure that the permissions created in an earlier migration exist!
    emit_post_migrate_signal(2, False, 'default')

    # Create and add permissions for the read only group
    group, created = Group.objects.get_or_create(name='read_only')
    if created:
        logger.info('read_only group created')
    [group.permissions.add(perm) for perm in get_read_only_permissions()]
    group.save()
    logger.info('Node, user, spam and meeting permissions added to read only group')

    # Create  and add permissions for new OSF Admin group - can perform actions
    admin_group, created = Group.objects.get_or_create(name='osf_admin')
    if created:
        logger.info('admin_user Group created')
    [admin_group.permissions.add(perm) for perm in get_read_only_permissions()]
    [admin_group.permissions.add(perm) for perm in get_admin_permissions()]
    group.save()
    logger.info('Administrator permissions for Node, user, spam and meeting permissions added to admin group')

    # Create and add permissions for Prereg Admin group
    prereg_group, created = Group.objects.get_or_create(name='prereg_admin')
    if created:
        logger.info('Prereg admin group created')
    [prereg_group.permissions.add(perm) for perm in get_prereg_admin_permissions()]
    prereg_group.save()
    logger.info('Prereg read and administer permissions added to the prereg_admin group')

    # Add a metrics_only Group and permissions
    metrics_group, created = Group.objects.get_or_create(name='metrics_only')
    if created:
        logger.info('Metrics only group created')
    metrics_permission = Permission.objects.get(codename='view_metrics')
    metrics_group.permissions.add(metrics_permission)
    metrics_group.save()

    # Add a view_prereg Group and permissions
    prereg_view_group, created = Group.objects.get_or_create(name='prereg_view')
    if created:
        logger.info('Prereg view group created')
    prereg_view_permission = Permission.objects.get(codename='view_prereg')
    prereg_view_group.permissions.add(prereg_view_permission)
    prereg_view_group.save()


def remove_group_permissions(*args):
    # remove the read only group
    Group.objects.get(name='read_only').delete()

    # remove the prereg admin group
    Group.objects.get(name='prereg_admin').delete()

    # remove the osf admin group
    Group.objects.get(name='osf_admin').delete()

    # remove the  metrics group
    Group.objects.get(name='metrics_only').delete()

    # remove the new prereg view group
    Group.objects.get(name='prereg_view').delete()


# osf.migrations.0037_auto_20170227_1522
def add_partial_uniqueness_index(*args):
    sql = """
    CREATE UNIQUE INDEX one_bookmark_collection_per_user ON osf_abstractnode (creator_id, is_bookmark_collection, is_deleted)
        WHERE is_bookmark_collection=TRUE AND is_deleted=FALSE;
    """
    logger.info('Adding partial uniqueness index.')
    with connection.cursor() as cursor:
        cursor.execute(sql)

def remove_partial_uniqueness_index(*args):
    sql = """
    DROP INDEX IF EXISTS one_bookmark_collection_per_user
    """
    logger.info('Removing partial uniqueness index.')
    with connection.cursor() as cursor:
        cursor.execute(sql)


# osf.migrations.0040_ensure_root_field
def ensure_root(*args):
    nodes = AbstractNode.objects.filter(root=None)
    total = nodes.count()
    print('Migrating {} nodes'.format(total))
    for i, node in enumerate(nodes.iterator()):
        if not i % 100:
            print('{}/{} nodes migrated'.format(i, total))
        node.root = node.get_root()
        node.save()

def reset_root(*args):
    AbstractNode.objects.all().invalidated_update(root=None)


class Migration(migrations.Migration):

    replaces = [('osf', '0001_initial'), ('osf', '0033_create_permissions_for_admin_groups'), ('osf', '0002_auto_20161012_1229'), ('osf', '0003_auto_20161012_1244'), ('osf', '0004_auto_20161012_1459'), ('osf', '0005_remove_abstractnode_parent_node'), ('osf', '0005_pagecounter_useractivitycounter'), ('osf', '0006_merge'), ('osf', '0007_auto_20161017_1039'), ('osf', '0007_auto_20161014_1134'), ('osf', '0008_merge'), ('osf', '0009_osfuser_verification_key_v2'), ('osf', '0010_auto_20161025_1332'), ('osf', '0009_abstractnode_preprint_file'), ('osf', '0011_merge'), ('osf', '0012_auto_20161028_0908'), ('osf', '0013_auto_20161028_1014'), ('osf', '0014_remove_abstractnode_root'), ('osf', '0015_auto_20161104_1542'), ('osf', '0016_auto_20161107_1103'), ('osf', '0015_auto_20161104_1254'), ('osf', '0017_merge'), ('osf', '0014_auto_20161102_1903'), ('osf', '0015_merge'), ('osf', '0018_merge'), ('osf', '0019_auto_20161114_1233'), ('osf', '0020_conference_is_meeting'), ('osf', '0021_auto_20161116_0857'), ('osf', '0022_auto_20161118_1600'), ('osf', '0023_auto_20161208_1253'), ('osf', '0024_auto_20161209_1001'), ('osf', '0025_preprintprovider_social_instagram'), ('osf', '0026_preprintservice_license'), ('osf', '0027_preprintprovider_header_text'), ('osf', '0027_auto_20161212_1352'), ('osf', '0028_merge'), ('osf', '0029_externalaccount_date_last_refreshed'), ('osf', '0030_auto_20170130_1608'), ('osf', '0031_auto_20170202_0943'), ('osf', '0032_auto_20170217_1111'), ('osf', '0034_merge'), ('osf', '0035_adminlogentry_adminprofile'), ('osf', '0023_auto_20161212_1131'), ('osf', '0024_auto_20161212_1324'), ('osf', '0025_auto_20161212_1459'), ('osf', '0026_auto_20161213_1740'), ('osf', '0027_auto_20161213_2150'), ('osf', '0029_merge'), ('osf', '0030_merge'), ('osf', '0032_merge'), ('osf', '0033_auto_20170210_1019'), ('osf', '0036_merge'), ('osf', '0037_auto_20170227_1522'), ('osf', '0037_auto_20170227_1354'), ('osf', '0038_merge'), ('osf', '0038_abstractnode_root'), ('osf', '0039_merge'), ('osf', '0040_ensure_root_field'), ('osf', '0041_auto_20170308_1932'), ('osf', '0042_add_registration_registered_date_desc_index'), ('osf', '0043_auto_20170313_1717')]

    initial = True

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        ('auth', '0007_alter_validators_add_error_messages'),
    ]

    operations = [
        migrations.CreateModel(
            name='OSFUser',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('guid_string', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=255, null=True), blank=True, null=True, size=None)),
                ('content_type_pk', models.PositiveIntegerField(blank=True, null=True)),
                ('username', models.CharField(db_index=True, max_length=255, unique=True)),
                ('fullname', models.CharField(blank=True, max_length=255)),
                ('is_registered', models.BooleanField(db_index=True, default=False)),
                ('is_claimed', models.BooleanField(db_index=True, default=False)),
                ('security_messages', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('is_invited', models.BooleanField(db_index=True, default=False)),
                ('unclaimed_records', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('contributor_added_email_records', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('verification_key', models.CharField(blank=True, max_length=255, null=True)),
                ('email_last_sent', models.DateTimeField(blank=True, null=True)),
                ('emails', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), blank=True, default=list, size=None)),
                ('email_verifications', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('mailing_lists', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('mailchimp_mailing_lists', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('osf_mailing_lists', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=osf.models.user.get_default_mailing_lists)),
                ('date_registered', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('given_name', models.CharField(blank=True, max_length=255)),
                ('middle_names', models.CharField(blank=True, max_length=255)),
                ('family_name', models.CharField(blank=True, max_length=255)),
                ('suffix', models.CharField(blank=True, max_length=255)),
                ('external_identity', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('jobs', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list)),
                ('schools', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list)),
                ('social', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, validators=[osf.models.validators.validate_social])),
                ('piwik_token', models.CharField(blank=True, max_length=255)),
                ('date_last_login', models.DateTimeField(blank=True, null=True)),
                ('date_confirmed', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('date_disabled', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('comments_viewed_timestamp', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('timezone', models.CharField(default=b'Etc/UTC', max_length=255)),
                ('locale', models.CharField(default=b'en_US', max_length=255)),
                ('requested_deactivation', models.BooleanField(default=False)),
                ('notifications_configured', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('is_active', models.BooleanField(default=False)),
                ('is_staff', models.BooleanField(default=False)),
            ],
            options={
                'abstract': False,
            },
            bases=(dirtyfields.dirtyfields.DirtyFieldsMixin, models.Model),
        ),
        migrations.CreateModel(
            name='AbstractNode',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('guid_string', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=255, null=True), blank=True, null=True, size=None)),
                ('content_type_pk', models.PositiveIntegerField(blank=True, null=True)),
                ('spam_status', models.IntegerField(blank=True, db_index=True, default=None, null=True)),
                ('spam_pro_tip', models.CharField(blank=True, default=None, max_length=200, null=True)),
                ('spam_data', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('date_last_reported', models.DateTimeField(blank=True, db_index=True, default=None, null=True)),
                ('reports', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, validators=[osf.models.spam._validate_reports])),
                ('type', models.CharField(choices=[('osf.node', 'node'), ('osf.collection', 'collection'), ('osf.registration', 'registration')], db_index=True, max_length=255)),
                ('category', models.CharField(blank=True, choices=[(b'', b'Uncategorized'), (b'communication', b'Communication'), (b'hypothesis', b'Hypothesis'), (b'data', b'Data'), (b'instrumentation', b'Instrumentation'), (b'methods and measures', b'Methods and Measures'), (b'analysis', b'Analysis'), (b'project', b'Project'), (b'other', b'Other'), (b'procedure', b'Procedure'), (b'software', b'Software')], default=b'', max_length=255)),
                ('child_node_subscriptions', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('date_created', models.DateTimeField(default=django.utils.timezone.now)),
                ('date_modified', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('deleted_date', models.DateTimeField(blank=True, null=True)),
                ('description', models.TextField(blank=True, default=b'')),
                ('file_guid_to_share_uuids', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('forked_date', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('is_fork', models.BooleanField(db_index=True, default=False)),
                ('is_public', models.BooleanField(db_index=True, default=False)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('piwik_site_id', models.IntegerField(blank=True, null=True)),
                ('public_comments', models.BooleanField(default=True)),
                ('suspended', models.BooleanField(db_index=True, default=False)),
                ('title', models.TextField(validators=[osf.models.validators.validate_title])),
                ('wiki_pages_current', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('wiki_pages_versions', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('wiki_private_uuids', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('preprint_created', models.DateTimeField(blank=True, null=True)),
                ('preprint_doi', models.CharField(blank=True, max_length=128, null=True, validators=[osf.models.validators.validate_doi])),
                ('_is_preprint_orphan', models.NullBooleanField(default=False)),
                ('is_bookmark_collection', models.NullBooleanField(db_index=True, default=False)),
                ('registered_date', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('registered_meta', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, null=True)),
            ],
            options={
                'abstract': False,
            },
            bases=(dirtyfields.dirtyfields.DirtyFieldsMixin, osf.models.mixins.CommentableMixin, models.Model),
        ),
        migrations.CreateModel(
            name='AlternativeCitation',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('name', models.CharField(max_length=256)),
                ('text', models.CharField(max_length=2048)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ApiOAuth2Application',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('client_id', models.CharField(db_index=True, default=osf.models.oauth.generate_client_id, max_length=50, unique=True)),
                ('client_secret', models.CharField(default=functools.partial(website.security.random_string, *(), **{b'length': 40}), max_length=40)),
                ('is_active', models.BooleanField(db_index=True, default=True)),
                ('name', models.CharField(db_index=True, max_length=200)),
                ('description', models.CharField(blank=True, max_length=1000, null=True)),
                ('date_created', models.DateTimeField(default=django.utils.timezone.now)),
                ('home_url', models.URLField()),
                ('callback_url', models.URLField()),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ApiOAuth2PersonalToken',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('token_id', models.CharField(default=functools.partial(website.security.random_string, *(), **{b'length': 70}), max_length=70, unique=True)),
                ('name', models.CharField(db_index=True, max_length=100)),
                ('scopes', models.CharField(max_length=300)),
                ('is_active', models.BooleanField(db_index=True, default=True)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ApiOAuth2Scope',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('name', models.CharField(db_index=True, max_length=50, unique=True)),
                ('description', models.CharField(max_length=255)),
                ('is_active', models.BooleanField(db_index=True, default=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ArchiveJob',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('done', models.BooleanField(default=False, verbose_name=b'completed')),
                ('sent', models.BooleanField(default=False, verbose_name=b'emails sent')),
                ('status', models.CharField(default=b'INITIATED', max_length=40)),
                ('datetime_initiated', models.DateTimeField(default=django.utils.timezone.now, verbose_name=b'initiated at')),
                ('initiator', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ArchiveTarget',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('name', models.CharField(max_length=2048)),
                ('status', models.CharField(default=b'INITIATED', max_length=40)),
                ('stat_result', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True)),
                ('errors', django.contrib.postgres.fields.ArrayField(base_field=models.TextField(), blank=True, default=list, size=None)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='BlackListGuid',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('guid', osf.utils.fields.LowercaseCharField(db_index=True, max_length=255, unique=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='CitationStyle',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, max_length=255)),
                ('title', models.CharField(max_length=255)),
                ('date_parsed', models.DateTimeField(default=django.utils.timezone.now)),
                ('short_title', models.CharField(max_length=2048)),
                ('summary', models.CharField(max_length=4200)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Comment',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('guid_string', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=255, null=True), blank=True, null=True, size=None)),
                ('content_type_pk', models.PositiveIntegerField(blank=True, null=True)),
                ('spam_status', models.IntegerField(blank=True, db_index=True, default=None, null=True)),
                ('spam_pro_tip', models.CharField(blank=True, default=None, max_length=200, null=True)),
                ('spam_data', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('date_last_reported', models.DateTimeField(blank=True, db_index=True, default=None, null=True)),
                ('reports', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, validators=[osf.models.spam._validate_reports])),
                ('date_created', models.DateTimeField(default=django.utils.timezone.now)),
                ('date_modified', models.DateTimeField(default=django.utils.timezone.now)),
                ('modified', models.BooleanField(default=False)),
                ('is_deleted', models.BooleanField(default=False)),
                ('page', models.CharField(blank=True, max_length=255)),
                ('content', models.TextField(validators=[osf.models.validators.CommentMaxLength(500), osf.models.validators.string_required])),
                ('ever_mentioned', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=10), blank=True, default=list, size=None)),
                ('node', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode')),
            ],
            options={
                'abstract': False,
            },
            bases=(osf.models.mixins.CommentableMixin, models.Model),
        ),
        migrations.CreateModel(
            name='Conference',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('endpoint', models.CharField(db_index=True, max_length=255, unique=True)),
                ('name', models.CharField(max_length=255)),
                ('info_url', models.URLField(blank=True)),
                ('logo_url', models.URLField(blank=True)),
                ('location', models.CharField(blank=True, max_length=2048)),
                ('start_date', models.DateTimeField(blank=True, null=True)),
                ('end_date', models.DateTimeField(blank=True, null=True)),
                ('active', models.BooleanField()),
                ('public_projects', models.BooleanField(default=True)),
                ('poster', models.BooleanField(default=True)),
                ('talk', models.BooleanField(default=True)),
                ('field_names', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(default=osf.models.conference.get_default_field_names)),
                ('num_submissions', models.IntegerField(default=0)),
                ('admins', models.ManyToManyField(to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Contributor',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('read', models.BooleanField(default=False)),
                ('write', models.BooleanField(default=False)),
                ('admin', models.BooleanField(default=False)),
                ('visible', models.BooleanField(default=False)),
                ('node', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='DraftRegistration',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('datetime_initiated', models.DateTimeField(default=django.utils.timezone.now)),
                ('datetime_updated', models.DateTimeField(auto_now=True)),
                ('registration_metadata', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('_metaschema_flags', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('notes', models.TextField(blank=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='DraftRegistrationApproval',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('approval_state', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('end_date', models.DateTimeField(blank=True, default=None, null=True)),
                ('initiation_date', models.DateTimeField(blank=True, null=True)),
                ('state', models.CharField(choices=[(b'unapproved', b'Unapproved'), (b'approved', b'Approved'), (b'rejected', b'Rejected'), (b'completed', b'Completed')], default=b'unapproved', max_length=255)),
                ('meta', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='DraftRegistrationLog',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('date', models.DateTimeField(default=django.utils.timezone.now)),
                ('action', models.CharField(max_length=255)),
                ('draft', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='osf.DraftRegistration')),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Embargo',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('approval_state', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('end_date', models.DateTimeField(blank=True, default=None, null=True)),
                ('initiation_date', models.DateTimeField(blank=True, null=True)),
                ('state', models.CharField(choices=[(b'unapproved', b'Unapproved'), (b'approved', b'Approved'), (b'rejected', b'Rejected'), (b'completed', b'Completed')], default=b'unapproved', max_length=255)),
                ('notify_initiator_on_complete', models.BooleanField(default=False)),
                ('stashed_urls', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('for_existing_registration', models.BooleanField(default=False)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
            bases=(osf.models.sanctions.PreregCallbackMixin, models.Model),
        ),
        migrations.CreateModel(
            name='EmbargoTerminationApproval',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('approval_state', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('end_date', models.DateTimeField(blank=True, default=None, null=True)),
                ('initiation_date', models.DateTimeField(blank=True, null=True)),
                ('state', models.CharField(choices=[(b'unapproved', b'Unapproved'), (b'approved', b'Approved'), (b'rejected', b'Rejected'), (b'completed', b'Completed')], default=b'unapproved', max_length=255)),
                ('notify_initiator_on_complete', models.BooleanField(default=False)),
                ('stashed_urls', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ExternalAccount',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('oauth_key', models.CharField(blank=True, max_length=255, null=True)),
                ('oauth_secret', models.CharField(blank=True, max_length=255, null=True)),
                ('refresh_token', models.CharField(blank=True, max_length=255, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('scopes', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=128), blank=True, default=list, size=None)),
                ('provider', models.CharField(max_length=50)),
                ('provider_name', models.CharField(max_length=255)),
                ('provider_id', models.CharField(max_length=255)),
                ('display_name', models.CharField(blank=True, max_length=255, null=True)),
                ('profile_url', models.URLField(blank=True, null=True)),
            ],
        ),
        migrations.CreateModel(
            name='FileVersion',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('identifier', models.CharField(max_length=100)),
                ('date_created', models.DateTimeField()),
                ('size', models.BigIntegerField(null=True)),
                ('content_type', models.CharField(blank=True, max_length=100, null=True)),
                ('date_modified', models.DateTimeField(blank=True, null=True)),
                ('location', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, db_index=True, default=dict, null=True)),
                ('metadata', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(db_index=True, default=dict)),
                ('creator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Guid',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('_id', osf.utils.fields.LowercaseCharField(db_index=True, default=osf.models.base.generate_guid, max_length=255, unique=True)),
                ('object_id', models.PositiveIntegerField(blank=True, null=True)),
                ('created', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.ContentType')),
            ],
            options={
                'ordering': ['-created'],
                'get_latest_by': 'created',
            },
        ),
        migrations.CreateModel(
            name='Identifier',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('object_id', models.PositiveIntegerField(blank=True, null=True)),
                ('category', models.CharField(max_length=10)),
                ('value', models.CharField(max_length=50)),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.ContentType')),
            ],
        ),
        migrations.CreateModel(
            name='Institution',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('banner_name', models.CharField(blank=True, max_length=255, null=True)),
                ('login_url', models.URLField(null=True)),
                ('domains', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), db_index=True, null=True, size=None)),
                ('email_domains', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), db_index=True, null=True, size=None)),
                ('logo_name', models.CharField(max_length=255, null=True)),
                ('logout_url', models.URLField(null=True)),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True, default=b'', null=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='InstitutionalContributor',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('read', models.BooleanField(default=False)),
                ('write', models.BooleanField(default=False)),
                ('admin', models.BooleanField(default=False)),
                ('visible', models.BooleanField(default=False)),
                ('institution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='osf.Institution')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='MailRecord',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('data', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField()),
                ('users_created', models.ManyToManyField(to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='MetaSchema',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('name', models.CharField(max_length=255)),
                ('schema', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(default=dict)),
                ('category', models.CharField(blank=True, max_length=255, null=True)),
                ('schema_version', models.IntegerField()),
            ],
        ),
        migrations.CreateModel(
            name='NodeLicense',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('license_id', models.CharField(max_length=128, unique=True)),
                ('name', models.CharField(max_length=256, unique=True)),
                ('text', models.TextField()),
                ('properties', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=128), blank=True, default=list, size=None)),
            ],
        ),
        migrations.CreateModel(
            name='NodeLicenseRecord',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('year', models.CharField(max_length=128)),
                ('copyright_holders', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=256, null=True), blank=True, default=list, size=None)),
                ('node_license', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='osf.NodeLicense')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='NodeLog',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('date', models.DateTimeField(blank=True, db_index=True, default=django.utils.timezone.now, null=True)),
                ('action', models.CharField(db_index=True, max_length=255)),
                ('params', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(default=dict)),
                ('should_hide', models.BooleanField(default=False)),
                ('foreign_user', models.CharField(blank=True, max_length=255, null=True)),
                ('node', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='osf.AbstractNode')),
                ('original_node', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-date'],
                'get_latest_by': 'date',
            },
        ),
        migrations.CreateModel(
            name='NodeRelation',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('is_node_link', models.BooleanField(db_index=True, default=False)),
                ('child', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode')),
                ('parent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='node_relations', to='osf.AbstractNode')),
            ],
        ),
        migrations.CreateModel(
            name='NotificationDigest',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('timestamp', models.DateTimeField()),
                ('send_type', models.CharField(db_index=True, max_length=50, validators=[osf.models.validators.validate_subscription_type])),
                ('event', models.CharField(max_length=50)),
                ('message', models.CharField(max_length=2048)),
                ('node_lineage', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=5), size=None)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='NotificationSubscription',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, max_length=50)),
                ('event_name', models.CharField(max_length=50)),
                ('email_digest', models.ManyToManyField(related_name='_notificationsubscription_email_digest_+', to=settings.AUTH_USER_MODEL)),
                ('email_transactional', models.ManyToManyField(related_name='_notificationsubscription_email_transactional_+', to=settings.AUTH_USER_MODEL)),
                ('none', models.ManyToManyField(related_name='_notificationsubscription_none_+', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notification_subscriptions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='PreprintProvider',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('name', models.CharField(max_length=128)),
                ('logo_name', models.CharField(blank=True, max_length=128, null=True)),
                ('description', models.CharField(blank=True, max_length=256, null=True)),
                ('banner_name', models.CharField(blank=True, max_length=128, null=True)),
                ('external_url', models.URLField(blank=True, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='PrivateLink',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('date_created', models.DateTimeField(default=django.utils.timezone.now)),
                ('key', models.CharField(max_length=512, unique=True)),
                ('name', models.CharField(blank=True, max_length=255, null=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('anonymous', models.BooleanField(default=False)),
                ('creator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('nodes', models.ManyToManyField(related_name='private_links', to=b'osf.AbstractNode')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='QueuedMail',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('to_addr', models.CharField(max_length=255)),
                ('send_at', models.DateTimeField(db_index=True)),
                ('email_type', models.CharField(db_index=True, max_length=255)),
                ('data', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('sent_at', models.DateTimeField(blank=True, db_index=True, null=True)),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='RecentlyAddedContributor',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_added', models.DateTimeField(auto_now=True)),
                ('contributor', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recently_added_by', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='RegistrationApproval',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('approval_state', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('end_date', models.DateTimeField(blank=True, default=None, null=True)),
                ('initiation_date', models.DateTimeField(blank=True, null=True)),
                ('state', models.CharField(choices=[(b'unapproved', b'Unapproved'), (b'approved', b'Approved'), (b'rejected', b'Rejected'), (b'completed', b'Completed')], default=b'unapproved', max_length=255)),
                ('notify_initiator_on_complete', models.BooleanField(default=False)),
                ('stashed_urls', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
            bases=(osf.models.sanctions.PreregCallbackMixin, models.Model),
        ),
        migrations.CreateModel(
            name='Retraction',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('approval_state', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('end_date', models.DateTimeField(blank=True, default=None, null=True)),
                ('initiation_date', models.DateTimeField(blank=True, null=True)),
                ('state', models.CharField(choices=[(b'unapproved', b'Unapproved'), (b'approved', b'Approved'), (b'rejected', b'Rejected'), (b'completed', b'Completed')], default=b'unapproved', max_length=255)),
                ('notify_initiator_on_complete', models.BooleanField(default=False)),
                ('stashed_urls', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
                ('justification', models.CharField(blank=True, max_length=2048, null=True)),
                ('initiated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Session',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('date_created', models.DateTimeField(auto_now_add=True)),
                ('date_modified', models.DateTimeField(auto_now=True)),
                ('data', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='StoredFileNode',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('guid_string', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=255, null=True), blank=True, null=True, size=None)),
                ('content_type_pk', models.PositiveIntegerField(blank=True, null=True)),
                ('last_touched', models.DateTimeField(blank=True, null=True)),
                ('history', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=[])),
                ('is_file', models.BooleanField(default=True)),
                ('provider', models.CharField(db_index=True, max_length=25)),
                ('name', models.CharField(blank=True, max_length=1000, null=True)),
                ('path', models.CharField(blank=True, max_length=2000, null=True)),
                ('_materialized_path', models.CharField(blank=True, max_length=1000, null=True)),
                ('checkout', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('copied_from', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='copy_of', to='osf.StoredFileNode')),
                ('node', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode')),
                ('parent', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='child', to='osf.StoredFileNode')),
            ],
            bases=(osf.models.mixins.CommentableMixin, models.Model),
        ),
        migrations.CreateModel(
            name='Subject',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('text', models.CharField(max_length=256, unique=True)),
                ('parents', models.ManyToManyField(related_name='children', to=b'osf.Subject')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Tag',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(db_index=True, max_length=1024)),
                ('system', models.BooleanField(default=False)),
            ],
        ),
        migrations.CreateModel(
            name='TrashedFileNode',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True)),
                ('guid_string', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=255, null=True), blank=True, null=True, size=None)),
                ('content_type_pk', models.PositiveIntegerField(blank=True, null=True)),
                ('last_touched', models.DateTimeField(blank=True, null=True)),
                ('history', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list)),
                ('object_id', models.PositiveIntegerField(blank=True, null=True)),
                ('is_file', models.BooleanField(default=True)),
                ('provider', models.CharField(blank=True, max_length=25, null=True)),
                ('name', models.CharField(blank=True, max_length=1000, null=True)),
                ('path', models.CharField(blank=True, max_length=200, null=True)),
                ('_materialized_path', models.CharField(blank=True, max_length=300, null=True)),
                ('deleted_on', models.DateTimeField()),
                ('suspended', models.BooleanField(default=False)),
                ('checkout', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='trashed_files_checked_out', to=settings.AUTH_USER_MODEL)),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.ContentType')),
                ('copied_from', models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.StoredFileNode')),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='files_deleted_by', to=settings.AUTH_USER_MODEL)),
                ('node', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode')),
                ('tags', models.ManyToManyField(to=b'osf.Tag')),
                ('versions', models.ManyToManyField(to=b'osf.FileVersion')),
            ],
            options={
                'abstract': False,
            },
            bases=(osf.models.mixins.CommentableMixin, models.Model),
        ),
        migrations.AlterUniqueTogether(
            name='tag',
            unique_together=set([('name', 'system')]),
        ),
        migrations.AddField(
            model_name='storedfilenode',
            name='tags',
            field=models.ManyToManyField(to=b'osf.Tag'),
        ),
        migrations.AddField(
            model_name='storedfilenode',
            name='versions',
            field=models.ManyToManyField(to=b'osf.FileVersion'),
        ),
        migrations.AlterUniqueTogether(
            name='nodelicense',
            unique_together=set([('_id', 'license_id')]),
        ),
        migrations.AlterUniqueTogether(
            name='metaschema',
            unique_together=set([('name', 'schema_version')]),
        ),
        migrations.AddField(
            model_name='institution',
            name='contributors',
            field=models.ManyToManyField(related_name='institutions', through='osf.InstitutionalContributor', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterUniqueTogether(
            name='externalaccount',
            unique_together=set([('provider', 'provider_id')]),
        ),
        migrations.AddField(
            model_name='draftregistration',
            name='approval',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.DraftRegistrationApproval'),
        ),
        migrations.AddField(
            model_name='draftregistration',
            name='initiator',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='draftregistration',
            name='registration_schema',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.MetaSchema'),
        ),
        migrations.AddField(
            model_name='comment',
            name='root_target',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='comments', to='osf.Guid'),
        ),
        migrations.AddField(
            model_name='comment',
            name='target',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='child_comments', to='osf.Guid'),
        ),
        migrations.AddField(
            model_name='comment',
            name='user',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='archivejob',
            name='target_addons',
            field=models.ManyToManyField(to=b'osf.ArchiveTarget'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='_contributors',
            field=models.ManyToManyField(related_name='nodes', through='osf.Contributor', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='_nodes',
            field=models.ManyToManyField(related_name='parent_nodes', through='osf.NodeRelation', to=b'osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='affiliated_institutions',
            field=models.ManyToManyField(related_name='nodes', to=b'osf.Institution'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='alternative_citations',
            field=models.ManyToManyField(related_name='nodes', to=b'osf.AlternativeCitation'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='creator',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='embargo',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='registrations', to='osf.Embargo'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='embargo_termination_approval',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='registrations', to='osf.EmbargoTerminationApproval'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='forked_from',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='forks', to='osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='node_license',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='nodes', to='osf.NodeLicenseRecord'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='registered_from',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='registrations', to='osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='registered_schema',
            field=models.ManyToManyField(to=b'osf.MetaSchema'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='registered_user',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='related_to', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='registration_approval',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='registrations', to='osf.RegistrationApproval'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='retraction',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='registrations', to='osf.Retraction'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='root',
            field=models.ForeignKey(blank=True, default=None, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='descendants', to='osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='tags',
            field=models.ManyToManyField(related_name='tagged', to=b'osf.Tag'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='template_node',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='templated_from', to='osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='users_watching_node',
            field=models.ManyToManyField(related_name='watching', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='affiliated_institutions',
            field=models.ManyToManyField(to=b'osf.Institution'),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='external_accounts',
            field=models.ManyToManyField(to=b'osf.ExternalAccount'),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='groups',
            field=models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to=b'auth.Group', verbose_name='groups'),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='merged_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='merger', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='recently_added',
            field=models.ManyToManyField(through='osf.RecentlyAddedContributor', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='tags',
            field=models.ManyToManyField(to=b'osf.Tag'),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='user_permissions',
            field=models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to=b'auth.Permission', verbose_name='user permissions'),
        ),
        migrations.CreateModel(
            name='Collection',
            fields=[
            ],
            options={
                'proxy': True,
            },
            bases=('osf.abstractnode',),
        ),
        migrations.CreateModel(
            name='Node',
            fields=[
            ],
            options={
                'proxy': True,
            },
            bases=('osf.abstractnode',),
        ),
        migrations.CreateModel(
            name='Registration',
            fields=[
            ],
            options={
                'proxy': True,
            },
            bases=('osf.abstractnode',),
        ),
        migrations.AlterUniqueTogether(
            name='storedfilenode',
            unique_together=set([('node', 'name', 'parent', 'is_file', 'provider', 'path')]),
        ),
        migrations.AlterIndexTogether(
            name='storedfilenode',
            index_together=set([('node', 'is_file', 'provider'), ('path', 'node', 'is_file', 'provider')]),
        ),
        migrations.AlterUniqueTogether(
            name='recentlyaddedcontributor',
            unique_together=set([('user', 'contributor')]),
        ),
        migrations.AddField(
            model_name='notificationsubscription',
            name='node',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notification_subscriptions', to='osf.Node'),
        ),
        migrations.AlterUniqueTogether(
            name='noderelation',
            unique_together=set([('parent', 'child')]),
        ),
        migrations.AlterOrderWithRespectTo(
            name='noderelation',
            order_with_respect_to='parent',
        ),
        migrations.AddField(
            model_name='mailrecord',
            name='nodes_created',
            field=models.ManyToManyField(to=b'osf.Node'),
        ),
        migrations.AlterUniqueTogether(
            name='institutionalcontributor',
            unique_together=set([('user', 'institution')]),
        ),
        migrations.AlterUniqueTogether(
            name='identifier',
            unique_together=set([('object_id', 'content_type', 'category')]),
        ),
        migrations.AlterIndexTogether(
            name='fileversion',
            index_together=set([('_id', 'metadata')]),
        ),
        migrations.AddField(
            model_name='embargoterminationapproval',
            name='embargoed_registration',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.Registration'),
        ),
        migrations.AddField(
            model_name='draftregistration',
            name='branched_from',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, related_name='registered_draft', to='osf.Node'),
        ),
        migrations.AddField(
            model_name='draftregistration',
            name='registered_node',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='draft_registration', to='osf.Registration'),
        ),
        migrations.AlterUniqueTogether(
            name='contributor',
            unique_together=set([('user', 'node')]),
        ),
        migrations.AlterOrderWithRespectTo(
            name='contributor',
            order_with_respect_to='node',
        ),
        migrations.AddField(
            model_name='archivejob',
            name='dst_node',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='archive_jobs', to='osf.Registration', verbose_name=b'destination node'),
        ),
        migrations.AddField(
            model_name='archivejob',
            name='src_node',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='osf.Node', verbose_name=b'source node'),
        ),
        migrations.RunPython(add_group_permissions, remove_group_permissions),
        migrations.AlterField(
            model_name='apioauth2application',
            name='client_secret',
            field=models.CharField(default=osf.models.oauth.generate_client_secret, max_length=40),
        ),
        migrations.AlterField(
            model_name='apioauth2personaltoken',
            name='token_id',
            field=models.CharField(default=osf.models.oauth.generate_token_id, max_length=70, unique=True),
        ),
        migrations.AlterField(
            model_name='citationstyle',
            name='short_title',
            field=models.CharField(blank=True, max_length=2048, null=True),
        ),
        migrations.AlterField(
            model_name='citationstyle',
            name='summary',
            field=models.CharField(blank=True, max_length=4200, null=True),
        ),
        migrations.AlterField(
            model_name='alternativecitation',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='apioauth2application',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='apioauth2personaltoken',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='apioauth2scope',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='archivejob',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='archivetarget',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='conference',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='draftregistration',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationlog',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='identifier',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='institution',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='mailrecord',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='metaschema',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='nodelicense',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='nodelicenserecord',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='nodelog',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='noderelation',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='notificationdigest',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='preprintprovider',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='privatelink',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='queuedmail',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='session',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='storedfilenode',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='subject',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.AlterField(
            model_name='trashedfilenode',
            name='_id',
            field=models.CharField(db_index=True, default=osf.models.base.generate_object_id, max_length=24, unique=True),
        ),
        migrations.CreateModel(
            name='PageCounter',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, max_length=300, unique=True)),
                ('date', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(default=dict)),
                ('total', models.PositiveIntegerField(default=0)),
                ('unique', models.PositiveIntegerField(default=0)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='UserActivityCounter',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_id', models.CharField(db_index=True, max_length=5, unique=True)),
                ('action', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(default=dict)),
                ('date', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(default=dict)),
                ('total', models.PositiveIntegerField(default=0)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='keenio_read_key',
            field=models.CharField(blank=True, max_length=1000, null=True),
        ),
        migrations.AlterField(
            model_name='institution',
            name='domains',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), blank=True, db_index=True, null=True, size=None),
        ),
        migrations.AlterField(
            model_name='institution',
            name='email_domains',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), blank=True, db_index=True, null=True, size=None),
        ),
        migrations.AlterField(
            model_name='institution',
            name='login_url',
            field=models.URLField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='institution',
            name='logout_url',
            field=models.URLField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='osfuser',
            name='verification_key_v2',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, null=True),
        ),
        migrations.AlterModelOptions(
            name='fileversion',
            options={'ordering': ('date_created',)},
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='date_created',
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='location',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(db_index=True, default=dict, null=True, validators=[osf.models.validators.validate_location]),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='metadata',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, db_index=True, default=dict),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='size',
            field=models.BigIntegerField(blank=True, default=-1),
        ),
        migrations.AlterField(
            model_name='trashedfilenode',
            name='deleted_on',
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='preprint_file',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='osf.StoredFileNode'),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='display_name',
            field=osf.utils.fields.EncryptedTextField(blank=True, max_length=255, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='oauth_key',
            field=osf.utils.fields.EncryptedTextField(blank=True, max_length=255, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='oauth_secret',
            field=osf.utils.fields.EncryptedTextField(blank=True, max_length=255, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='profile_url',
            field=osf.utils.fields.EncryptedTextField(blank=True, max_length=512, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='refresh_token',
            field=osf.utils.fields.EncryptedTextField(blank=True, max_length=255, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='display_name',
            field=osf.utils.fields.EncryptedTextField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='oauth_key',
            field=osf.utils.fields.EncryptedTextField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='oauth_secret',
            field=osf.utils.fields.EncryptedTextField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='profile_url',
            field=osf.utils.fields.EncryptedTextField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='refresh_token',
            field=osf.utils.fields.EncryptedTextField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='PreprintService',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('guid_string', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, max_length=255, null=True), blank=True, null=True, size=None)),
                ('content_type_pk', models.PositiveIntegerField(blank=True, null=True)),
                ('date_created', models.DateTimeField(default=django.utils.timezone.now)),
                ('date_modified', models.DateTimeField(auto_now=True)),
                ('is_published', models.BooleanField(db_index=True, default=False)),
                ('date_published', models.DateTimeField(blank=True, null=True)),
                ('subjects', osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list, null=True)),
            ],
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='date_last_reported',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='registered_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='comment',
            name='date_last_reported',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistration',
            name='datetime_initiated',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='draftregistration',
            name='datetime_updated',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationlog',
            name='date',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_confirmed',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_disabled',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_last_login',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_registered',
            field=osf.utils.fields.NonNaiveDateTimeField(db_index=True, default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='email_last_sent',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='privatelink',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='queuedmail',
            name='send_at',
            field=osf.utils.fields.NonNaiveDateTimeField(db_index=True),
        ),
        migrations.AlterField(
            model_name='queuedmail',
            name='sent_at',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='session',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now_add=True),
        ),
        migrations.AlterField(
            model_name='session',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now=True),
        ),
        migrations.AddField(
            model_name='preprintservice',
            name='node',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to='osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='preprintservice',
            name='provider',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='preprint_services', to='osf.PreprintProvider'),
        ),
        migrations.AlterUniqueTogether(
            name='preprintservice',
            unique_together=set([('node', 'provider')]),
        ),
        migrations.RenameField(
            model_name='abstractnode',
            old_name='preprint_doi',
            new_name='preprint_article_doi',
        ),
        migrations.RemoveField(
            model_name='abstractnode',
            name='preprint_created',
        ),
        migrations.AddField(
            model_name='abstractnode',
            name='_has_abandoned_preprint',
            field=models.BooleanField(default=False),
        ),
        migrations.AlterField(
            model_name='preprintservice',
            name='node',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='preprint', to='osf.AbstractNode'),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='date_last_reported',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='registered_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='comment',
            name='date_last_reported',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistration',
            name='datetime_initiated',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='draftregistration',
            name='datetime_updated',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistrationlog',
            name='date',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_confirmed',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_disabled',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_last_login',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='date_registered',
            field=osf.utils.fields.NonNaiveDateTimeField(db_index=True, default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='email_last_sent',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='privatelink',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='queuedmail',
            name='send_at',
            field=osf.utils.fields.NonNaiveDateTimeField(db_index=True),
        ),
        migrations.AlterField(
            model_name='queuedmail',
            name='sent_at',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='session',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now_add=True),
        ),
        migrations.AlterField(
            model_name='session',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now=True),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='tags',
            field=models.ManyToManyField(related_name='abstractnode_tagged', to=b'osf.Tag'),
        ),
        migrations.AlterField(
            model_name='storedfilenode',
            name='tags',
            field=models.ManyToManyField(related_name='storedfilenode_tagged', to=b'osf.Tag'),
        ),
        migrations.AlterField(
            model_name='preprintservice',
            name='node',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='preprints', to='osf.AbstractNode'),
        ),
        migrations.AddField(
            model_name='conference',
            name='is_meeting',
            field=models.BooleanField(default=True),
        ),
        migrations.AlterField(
            model_name='conference',
            name='location',
            field=models.CharField(blank=True, max_length=2048, null=True),
        ),
        migrations.AddField(
            model_name='embargoterminationapproval',
            name='initiated_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterField(
            model_name='archivetarget',
            name='stat_result',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='location',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, db_index=True, default=dict, null=True, validators=[osf.models.validators.validate_location]),
        ),
        migrations.AlterField(
            model_name='session',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='access_token',
            field=osf.utils.fields.EncryptedTextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='advisory_board',
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='email_contact',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='email_support',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='example',
            field=models.CharField(blank=True, max_length=20, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='licenses_acceptable',
            field=models.ManyToManyField(blank=True, to=b'osf.NodeLicense'),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='social_facebook',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='social_twitter',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='subjects_acceptable',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='nodelicenserecord',
            name='year',
            field=models.CharField(blank=True, max_length=128, null=True),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='social_instagram',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name='preprintservice',
            name='license',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='osf.NodeLicenseRecord'),
        ),
        migrations.AddField(
            model_name='preprintprovider',
            name='header_text',
            field=models.TextField(blank=True, default=b''),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='locale',
            field=models.CharField(blank=True, default=b'en_US', max_length=255),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='timezone',
            field=models.CharField(blank=True, default=b'Etc/UTC', max_length=255),
        ),
        migrations.AddField(
            model_name='externalaccount',
            name='date_last_refreshed',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AlterModelOptions(
            name='conference',
            options={'permissions': (('view_conference', 'Can view conference details in the admin app.'),)},
        ),
        migrations.AlterModelOptions(
            name='node',
            options={'permissions': (('view_node', 'Can view node details'),)},
        ),
        migrations.AlterModelOptions(
            name='osfuser',
            options={'permissions': (('view_user', 'Can view user details'),)},
        ),
        migrations.AlterModelOptions(
            name='registration',
            options={'permissions': (('view_registration', 'Can view registration details'),)},
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='affiliated_institutions',
            field=models.ManyToManyField(blank=True, to=b'osf.Institution'),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='external_accounts',
            field=models.ManyToManyField(blank=True, to=b'osf.ExternalAccount'),
        ),
        migrations.AlterModelManagers(
            name='osfuser',
            managers=[
                ('subselect', django.db.models.manager.Manager()),
            ],
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='tags',
            field=models.ManyToManyField(blank=True, to=b'osf.Tag'),
        ),
        migrations.CreateModel(
            name='AdminLogEntry',
            fields=[
            ],
            options={
                'proxy': True,
            },
            bases=(LogEntry,),
            managers=[
                ('objects', osf.models.admin_log_entry.AdminLogEntryManager()),
            ],
        ),
        migrations.CreateModel(
            name='AdminProfile',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('desk_token', models.CharField(blank=True, max_length=45)),
                ('desk_token_secret', models.CharField(blank=True, max_length=45)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='admin_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'permissions': (('mark_spam', 'Can mark comments, projects and registrations as spam'), ('view_spam', 'Can view nodes, comments, and projects marked as spam'), ('view_metrics', 'Can view metrics on the OSF Admin app'), ('view_prereg', 'Can view entries for the preregistration chellenge on the admin'), ('administer_prereg', 'Can update, comment on, and approve entries to the prereg challenge'), ('view_desk', 'Can view details about Desk users')),
            },
        ),
        migrations.AlterField(
            model_name='draftregistrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='embargo',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='embargoterminationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='location',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, null=True, validators=[osf.models.validators.validate_location]),
        ),
        migrations.AlterField(
            model_name='registrationapproval',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='retraction',
            name='initiation_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='session',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='location',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, db_index=True, default=dict, null=True, validators=[osf.models.validators.validate_location]),
        ),
        migrations.AlterIndexTogether(
            name='fileversion',
            index_together=set([]),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='location',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict, null=True, validators=[osf.models.validators.validate_location]),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='metadata',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=dict),
        ),
        migrations.AlterField(
            model_name='nodelicenserecord',
            name='year',
            field=models.CharField(blank=True, max_length=128, null=True),
        ),
        migrations.AlterField(
            model_name='draftregistration',
            name='datetime_updated',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='location',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=None, null=True, validators=[osf.models.validators.validate_location]),
        ),
        migrations.AlterField(
            model_name='guid',
            name='created',
            field=models.DateTimeField(db_index=True, default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='recentlyaddedcontributor',
            name='date_added',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.RunPython(add_partial_uniqueness_index, remove_partial_uniqueness_index),
        migrations.AlterModelManagers(
            name='osfuser',
            managers=[
            ],
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='deleted_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='abstractnode',
            name='forked_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, null=True),
        ),
        migrations.AlterField(
            model_name='apioauth2application',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='archivejob',
            name='datetime_initiated',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now, verbose_name=b'initiated at'),
        ),
        migrations.AlterField(
            model_name='citationstyle',
            name='date_parsed',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='comment',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='comment',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='conference',
            name='end_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='conference',
            name='start_date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='date_last_refreshed',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externalaccount',
            name='expires_at',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='fileversion',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='guid',
            name='created',
            field=osf.utils.fields.NonNaiveDateTimeField(db_index=True, default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='nodelog',
            name='date',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, db_index=True, default=django.utils.timezone.now, null=True),
        ),
        migrations.AlterField(
            model_name='notificationdigest',
            name='timestamp',
            field=osf.utils.fields.NonNaiveDateTimeField(),
        ),
        migrations.AlterField(
            model_name='preprintservice',
            name='date_created',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='preprintservice',
            name='date_modified',
            field=osf.utils.fields.NonNaiveDateTimeField(auto_now=True),
        ),
        migrations.AlterField(
            model_name='preprintservice',
            name='date_published',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='storedfilenode',
            name='last_touched',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='trashedfilenode',
            name='deleted_on',
            field=osf.utils.fields.NonNaiveDateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AlterField(
            model_name='trashedfilenode',
            name='last_touched',
            field=osf.utils.fields.NonNaiveDateTimeField(blank=True, null=True),
        ),
        migrations.AlterIndexTogether(
            name='guid',
            index_together=set([('content_type', 'object_id', 'created')]),
        ),
        migrations.AlterIndexTogether(
            name='noderelation',
            index_together=set([('is_node_link', 'child', 'parent')]),
        ),
        migrations.RunPython(ensure_root, reset_root),
        migrations.AlterIndexTogether(
            name='abstractnode',
            index_together=set([('is_public', 'is_deleted', 'type')]),
        ),
        migrations.RunSQL(
            sql=['CREATE INDEX osf_abstractnode_registered_date_index ON public.osf_abstractnode (registered_date DESC);', "CREATE INDEX osf_abstractnode_registration_pub_del_type_index ON public.osf_abstractnode (is_public, is_deleted, type) WHERE is_public=TRUE and is_deleted=FALSE and type = 'osf.registration';CREATE INDEX osf_abstractnode_node_pub_del_type_index ON public.osf_abstractnode (is_public, is_deleted, type) WHERE is_public=TRUE and is_deleted=FALSE and type = 'osf.node';CREATE INDEX osf_abstractnode_collection_pub_del_type_index ON public.osf_abstractnode (is_public, is_deleted, type) WHERE is_public=TRUE and is_deleted=FALSE and type = 'osf.collection';"],
            reverse_sql=['DROP INDEX public.osf_abstractnode_registered_date_index RESTRICT;DROP INDEX public.osf_abstractnode_registration_pub_del_type_index RESTRICT;DROP INDEX public.osf_abstractnode_node_pub_del_type_index RESTRICT;DROP INDEX public.osf_abstractnode_collection_pub_del_type_index RESTRICT;'],
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='fullname',
            field=models.CharField(max_length=255),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='jobs',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list, validators=[osf.models.validators.validate_history_item]),
        ),
        migrations.AlterField(
            model_name='osfuser',
            name='schools',
            field=osf.utils.datetime_aware_jsonfield.DateTimeAwareJSONField(blank=True, default=list, validators=[osf.models.validators.validate_history_item]),
        ),
    ]
